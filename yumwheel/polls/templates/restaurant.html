{%extends "index.html"%}
{%load static %}

{%block title%}The Yum Wheel suggests you eat at...{%endblock%}
{% block content %}
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <a class="navbar-brand" href="#">The Yum Wheel suggests you eat at {{variable}}</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse"
  data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
  aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item active">
        <a class="nav-link" href="/">Home <span class="sr-only">(current)</span></a>
      </li>
    </ul>
  </div>
</nav>

<style>
#map{
  height:500px;
  width: 60%;
  margin: 0 auto;
}
</style>
<!-- size of map -->

<div id = "map"></div>

<script>
var map;
var infowindow;
  function initMap(){
    var pos = {lat:39.7285,lng:-121.8375};
    map = new google.maps.Map(document.getElementById('map'), {
      center: pos,
      zoom: 14
    });
    infowindow = new google.maps.InfoWindow();
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(position) {
        var mypos = {
          lat: position.coords.latitude,
          lng: position.coords.longitude
        };
        infoWindow.setPosition(mypos);
        infoWindow.setContent('Location found.');
        map.setCenter(mypos);
      }, function() {
        handleLocationError(true, infoWindow, map.getCenter());
      });
    } else {
      handleLocationError(false, infoWindow, map.getCenter());
    }
    var service = new google.maps.places.PlacesService(map);
    service.nearbySearch({
      location: pos,
      radius: 500,
      type: ['restaurant']
    }, callback);
  }
  function callback(results, status) {
    if(status == google.maps.places.PlacesServiceStatus.OK){
      var rndnum = Math.floor(Math.random() * results.length);
      var place = results[rndnum];
      createMarker(results[rndnum]);
    }
  }
  function createMarker(place) {
  var placeLoc = place.geometry.location;
  var marker = new google.maps.Marker({
    map: map,
    position: place.geometry.location
  });
  google.maps.event.addListener(marker, 'click', function() {
    infowindow.setContent(place.name);
    infowindow.open(map, this);
  });
}
function handleLocationError(browserHasGeolocation, infoWindow, pos) {
     infoWindow.setPosition(pos);
     infoWindow.setContent(browserHasGeolocation ?
                           'Error: The Geolocation service failed.' :
                           'Error: Your browser doesn\'t support geolocation.');
     infoWindow.open(map);
   }

</script>

<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyACc6IrDW1i_Pee4QSl59bySwB0Bq75KdM&libraries=places&callback=initMap"></script>
<div style = "text-align:center">
  <a href="/" class="button">Return to Yum Wheel</a>
</div>
{% endblock %}
